// leanModal v1.1 by Ray Stone - http://finelysliced.com.au
// Dual licensed under the MIT and GPL

(function($){

	$.fn.extend({
		leanModal:function(options){
			var defaults={
				top:100,overlay:0.5,closeButton:null
			};

			var overlay=$("<div id='lean_overlay'></div>");
			$("body").append(overlay);
			options=$.extend(defaults,options);
			return this.each(function(){
				var o=options;
				$(this).one('click',(function(e){
                    
					var modal_id='#'+$('#nodemodal').attr("id");
					
					$("#lean_overlay").click(function(){
						close_modal(modal_id);
						$("#lean_overlay").unbind('click')
						
					});

					$("#cancelbtn").click(function(){
						close_modal(modal_id)
					});
					var modal_height=$(modal_id).outerHeight();
					var modal_width=$(modal_id).outerWidth();
					$("#lean_overlay").css({"display":"block",opacity:0});
					$("#lean_overlay").fadeTo(200,o.overlay);
					$(modal_id).css({"display":"block","position":"fixed","opacity":0,"z-index":110000,"left":50+"%","margin-left":-(modal_width/2)+"px","top":o.top+"px"});
					$(modal_id).fadeTo(200,1);
					e.preventDefault();
					es=event;
					$("#username").focus();//文本内容选取
					//console.log($("#username"))//.select();
                    $('#username').attr('value','节点'+(nodenum+1));
                     $('#password').attr('value',2);
                   //$('#username').trigger("click");

                    $("#loginbtn").click(function(){
                   
                    	$('#nodemodal').children('h2')[0].innerHTML='';
                    	var Nodename=$('#username').attr('value');
                    	var StateNum=$('#password').attr('value');
                    	console.log(Nodename,StateNum)
						  var flagSameName=0;

						     for(var i=0;i<=$('.BackG').length-1;i++)
						         { if($('.BackG').eq(i).attr('id')==Nodename)
						              {flagSameName=1;
						               break;
						               }
						          }

						  if (flagSameName==1)
						    {
						      var cover=$(this).parents('#nodemodal').children('h2');
						      var contentc=$('<a style="text-align:center;border:none;color:#e33">请不要输入重名节点!</a>')
						      cover.append(contentc);
						      contentc.fadeOut(3000);

						    }


						    else if(!(Nodename&&!isNaN(StateNum)&&StateNum!=0))//如果返回的有内容
         						{ var cover=$(this).parents('#nodemodal').children('h2');
						      var contentc=$('<a style="text-align:center;border:none;color:#e33">请输入正确的节点数（大于零整数'+nodenum+'）！</a>')
						      cover.append(contentc);
						      contentc.fadeOut(3000);
      						    }
      						  else{
                    	    CPT(es,Nodename,StateNum);
                    	    $("#lean_overlay").unbind('click')
                    	    $('#loginbtn').unbind('click');
                    	    close_modal(modal_id);
						      }

                    })


				})

				)
			});
			function close_modal(modal_id){
				$("#lean_overlay").fadeOut(200);
		        $("body").eq(0).unbind('keydown');
				$("#username").attr('value',''); 
				$("#password").attr('value',''); 
				$(modal_id).css({"display":"none"})
			}}
		})
})(jQuery);
